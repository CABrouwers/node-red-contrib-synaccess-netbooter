<script type="text/javascript">
    RED.nodes.registerType('sender', {
        category: 'Synaccess',
        color: '#c0c0c0',
        defaults: {
            name: { value: "" },
            signal: { value: "" },
            filter: { value: "" },
            netbooter: { value: "", type: "netbooter" },
        },
        inputs: 1,
        outputs: 0,
        icon: "sender.svg",
        label: function () {
            return this.name || "sender";
        }
    });
</script>

<script type="text/html" data-template-name="sender">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-netbooter"><i class="icon-tag"></i> Netbooter</label>
        <input type="text" id="node-input-netbooter" placeholder="netbooter">
    </div>
    <div class="form-row">
        <label for="node-input-filter"><i class="icon-tag"></i> Filter</label>
        <input type="text" id="node-input-filter" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-signal"><i class="icon-tag"></i> Signal</label>
        <input type="text" id="node-input-signal" placeholder="Name">
    </div>

</script>

<script type="text/html" data-help-name="sender">
    <p>A node used to send control messages to a Synaccess Netbooter.</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>
            <code>payload</code>
            <span class="property-type">string | JSON</span>
        </dt>
        <dd>Commands to be sent to the Netbooter. </dd>
    </dl>

    <h3>Details</h3>
    <p>
        The node processes <code>msg.payload</code>, sends as the corresponding command to the Netbooter,  then the interface  checks the state of the Netbooter and receivers nodes send messages reflecting the new state of the switches.
        Because of the long response time of Netbooters, several seconds can elapse between the sending of a command and the updates by receiver nodes.
    </p>
    <p>
        If the optional configuration fields <code>Filter</code> and <code>Signal</code> are left blank, the <code>msg.payload</code> represents the commands to be sent. Otherwise, it is modified before being sent.
    </p>
    <p>
        If an empty or invalid message is received, the states of the Netbooter switches won't change but but the receiver nodes will  send updates on the state of the switches. This behaviour can be used to just pool the Netbooter.
    </p>
    <p>
        When the optional configuration fields are not used, accepted <code>msg.payload</code> can either be in one of two forms:
        <ul>
            <li>Condendensed: a string such as <code>1110XTX</code>. Characters from left to right represents switches 1, 2, 3, 4, ... </li>
            <li>
                Detailed: a string or JSON in in the form
                <code>{ "1":off , "2":true, "router":on}</code>
                each pair <code>key:value</code> represents a respectively a switch and a command.
            </li>
        </ul>

    </p>
    <p>
        The allowed commands are:
        <ul>
            <li><code>false</code>, <code>"off"</code>,  <code>0</code>, <code>"0"</code></li>
            <li><code>true</code>, <code>"on"</code>,  <code>1</code>, <code>"1"</code></li>
            <li><code>T</code> (check current value and toggle)</li>
            <li><code>X</code> (ignore/do nothing)</li>
        </ul>
        In condensed form, only the caracters <code>0</code>, <code>1</code>, <code>T</code>,and  <code>X</code> are valid
    </p>
    <p>
        In detailed form, the switch are designated by a number or an optional label defined in the netbooter setup.
        Anything else is ignored. Non existant switch names are also ignored.  Switches and commands are not case sensitive.
        if the <code>msg.payload</code> is a string, {} and quotes are optional, except in the case of names containing space characters. Such names must be enclosed in single or double quotes.
    </p>
    <h4>Filter (optional)</h4>
    <p>
        The filter is an optional string such as <code>3, light, 1</code> representing a list of switches . When it is present, incoming <code>msg.payload</code>  will be filtered and only commands to the switches included in the filter list will sent to the Netbooter.
    </p>
    <h4>Signal (optional)</h4>
    <p>
        The signal field can be used to send a fixed command every time a message is received or to send anonymous commands to a specific switches.
    </p>
    <p>
        For example, if the signal string is <code>{1:off, "router":true}</code>, these commands will be sent to the Netbooter every time a message is received, the <code>msg.payload</code> of the received message will be ignored.
    </p>
    <p>
        If the signal string is <code>{2, "light"}</code>, the <code>msg.payload</code> should be a string in the form <code>true, off</code>. The two will be combined into the command string <code>{"2":1, "light":off}</code>
    </p>
    <p>
        The two methods can be combined and the <code>msg.payload</code> <code>true, off</code> combined with the signal string <code>{1:off, 2, "router":true, "light"}</code> would become the command <code>{"1":off, "":1, "router":true, "light":off}</code>
    </p>


</script>
